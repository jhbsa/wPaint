/*! wPaint - v2.5.0 - 2018-09-28 */
!function(e){e.fn.wPaint.menus.text={img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAASCAMAAAAnpt3PAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAArrAAAK6wGCiw1aAAAAFnRFWHRDcmVhdGlvbiBUaW1lADA4LzEwLzEzkEDgTAAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADkUExURUxMTP///0xMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTO2jd1cAAABLdFJOUwAAAgUJDA8TFxobHyQoLTE0Njg7QEVGR0pPWl9kaGpsb3p7hYiKj5CVl5qcn6SmqrG4ub3BwsnLzNPb3+Ll5ufp7O/x8/b5+vv8/o2LDuoAAAEpSURBVCjPndPZUsJQDAbgvxVpPSBYPW6AuBYVRQTErYhAqUj/938fLzq2acelQ+7OTL5JTjKBsVLAMAxLKVXROxYA/JJmKqWUDcBWSlkRcydk4AX0DyQ7GpHv5+vRY+3Q45MGoDvsVCMGLFgCmgyrslqdw6QpNFkGAGAGfLOACoDHrmSn7KaYipiXZQP2JGvxMhebsSbZHRs5WHnAWzmSjee37X8ZSY61ZHvzvpmjWqkV0hXsjG0j198aDO0k84YXabYJADAnWWYuWU8y73ksWYVXAIBaN8sQCGY+zvclw0t4AsCZ2llmySa3Jg8qxQq9cOH5ryXEzFyyAlgjtpORuLw2UgwoOLoIxMz1yU9vHE7r8QJ0/4Mc7grIJMThVLVT/ONwfrq3FeIL3LIwQskEl6kAAAAASUVORK5CYII=",items:{bold:{icon:"toggle",title:"Bold",index:0,callback:function(t){this.setFontBold(t)}},italic:{icon:"toggle",title:"Italic",index:1,callback:function(t){this.setFontItalic(t)}},fontSize:{title:"Font Size",icon:"select",range:[8,9,10,12,14,16,20,24,30],value:12,callback:function(t){this.setFontSize(t)}},fontFamily:{icon:"select",title:"Font Family",range:["Arial","Courier","Times","Verdana"],useRange:!0,value:"Arial",callback:function(t){this.setFontFamily(t)}}}},e.fn.wPaint.menus.main.items.text={icon:"menu",after:"pencil",title:"Text",index:7,callback:function(){this.setMode("text")}},e.extend(e.fn.wPaint.defaults,{fontSize:"12",fontFamily:"Arial",fontBold:!1,fontItalic:!1,fontUnderline:!1}),e.fn.wPaint.extend({generate:function(){this.$textCalc=e("<div></div>").hide(),this.$textInput=e('<textarea class="wPaint-text-input" spellcheck="false"></textarea>').on("mousedown",this._stopPropagation).css({position:"absolute"}).hide(),e("body").append(this.$textCalc),this.$el.append(this.$textInput),this.menus.all.text=this._createMenu("text")},_init:function(){var t=this;function i(){t._drawTextIfNotEmpty(),t.$textInput.hide(),t.$canvasTemp.hide()}for(var n in this.menus.all)this.menus.all[n].$menu.on("click",i).on("mousedown",this._stopPropagation);e(document).on("mousedown",i)},setFillStyle:function(t){this.$textInput.css("color",t)},setFontSize:function(t){this.options.fontSize=parseInt(t,10),this._setFont({fontSize:t+"px",lineHeight:t+"px"}),this.menus.all.text._setSelectValue("fontSize",t)},setFontFamily:function(t){this.options.fontFamily=t,this._setFont({fontFamily:t}),this.menus.all.text._setSelectValue("fontFamily",t)},setFontBold:function(t){this.options.fontBold=t,this._setFont({fontWeight:t?"bold":""})},setFontItalic:function(t){this.options.fontItalic=t,this._setFont({fontStyle:t?"italic":""})},setFontUnderline:function(t){this.options.fontUnderline=t,this._setFont({fontWeight:t?"underline":""})},_setFont:function(t){this.$textInput.css(t),this.$textCalc.css(t)},_drawTextDown:function(t){this._drawTextIfNotEmpty(),this._drawShapeDown(t,1),this.$textInput.css({left:t.pageX-1,top:t.pageY-1,width:0,height:0}).show().focus()},_drawTextMove:function(t){this._drawShapeMove(t,1),this.$textInput.css({left:t.left-1,top:t.top-1,width:t.width,height:t.height})},_drawTextIfNotEmpty:function(){""!==this.$textInput.val()&&this._drawText()},_drawText:function(){var t,i,n,e,o="",s=this.$textInput.val().split("\n"),x=[],l=this.$textInput.width()-2,a=0,h=this.$textInput.position(),T=h.left+1,E=h.top+1;for(this.options.fontItalic&&(o+="italic "),this.options.fontBold&&(o+="bold "),o+=this.options.fontSize+"px "+this.options.fontFamily,t=0,i=s.length;t<i;t++){for(this.$textCalc.html(""),n=a=0,e=s[t].length;n<e;n++)l<this.$textCalc.append(s[t][n]).width()&&(x.push(s[t].substring(a,n)),a=n,this.$textCalc.html(s[t][n]));a!==n&&x.push(s[t].substring(a,n))}for(t=0,i=(s=this.$textInput.val(x.join("\n")).val().split("\n")).length;t<i;t++)this.ctx.fillStyle=this.options.fillStyle,this.ctx.textBaseline="top",this.ctx.font=o,this.ctx.fillText(s[t],T,E),E+=this.options.fontSize;this.$textInput.val(""),this._addUndo()}})}(jQuery);