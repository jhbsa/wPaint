/*! wPaint - v2.5.1 - 2019-01-25 */
!function(e){e.fn.wPaint.menus.text={img:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADYAAAASCAMAAAAnpt3PAAAAA3NCSVQICAjb4U/gAAAACXBIWXMAAArrAAAK6wGCiw1aAAAAFnRFWHRDcmVhdGlvbiBUaW1lADA4LzEwLzEzkEDgTAAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADkUExURUxMTP///0xMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTO2jd1cAAABLdFJOUwAAAgUJDA8TFxobHyQoLTE0Njg7QEVGR0pPWl9kaGpsb3p7hYiKj5CVl5qcn6SmqrG4ub3BwsnLzNPb3+Ll5ufp7O/x8/b5+vv8/o2LDuoAAAEpSURBVCjPndPZUsJQDAbgvxVpPSBYPW6AuBYVRQTErYhAqUj/938fLzq2acelQ+7OTL5JTjKBsVLAMAxLKVXROxYA/JJmKqWUDcBWSlkRcydk4AX0DyQ7GpHv5+vRY+3Q45MGoDvsVCMGLFgCmgyrslqdw6QpNFkGAGAGfLOACoDHrmSn7KaYipiXZQP2JGvxMhebsSbZHRs5WHnAWzmSjee37X8ZSY61ZHvzvpmjWqkV0hXsjG0j198aDO0k84YXabYJADAnWWYuWU8y73ksWYVXAIBaN8sQCGY+zvclw0t4AsCZ2llmySa3Jg8qxQq9cOH5ryXEzFyyAlgjtpORuLw2UgwoOLoIxMz1yU9vHE7r8QJ0/4Mc7grIJMThVLVT/ONwfrq3FeIL3LIwQskEl6kAAAAASUVORK5CYII=",items:{bold:{icon:"toggle",title:"Bold",index:0,callback:function(t){this.setFontBold(t)}},italic:{icon:"toggle",title:"Italic",index:1,callback:function(t){this.setFontItalic(t)}},fontSize:{title:"Font Size",icon:"select",range:[8,10,12,14,16,20,24,30,36,42,48],value:20,callback:function(t){this.setFontSize(t)}},fontFamily:{icon:"select",title:"Font Family",range:["Arial","Courier","Times","Verdana"],useRange:!0,value:"Arial",callback:function(t){this.setFontFamily(t)}}}},e.fn.wPaint.menus.main.items.text={icon:"menu",after:"pencil",title:"Text",index:7,callback:function(){this.setMode("text")}},e.extend(e.fn.wPaint.defaults,{fontSize:"20",fontFamily:"Arial",fontBold:!1,fontItalic:!1,fontUnderline:!1}),e.fn.wPaint.extend({generate:function(){this.$textCalc=e("<div></div>").hide(),this.$textInput=e('<textarea class="wPaint-text-input" spellcheck="false"></textarea>').on("mousedown",this._stopPropagation).css({position:"absolute"}).hide(),e("body").append(this.$textCalc),this.$el.append(this.$textInput),this.menus.all.text=this._createMenu("text")},_init:function(){var t=this;function i(){t._drawTextIfNotEmpty(),t.$textInput.hide(),t.$canvasTemp.hide()}for(var n in this.menus.all)this.menus.all[n].$menu.on("click",i).on("mousedown",this._stopPropagation);e(document).on("mousedown",i)},setFillStyle:function(t){this.$textInput.css("color",t)},setFontSize:function(t){this.options.fontSize=parseInt(t,10),this._setFont({fontSize:t+"px",lineHeight:t+"px"}),this.menus.all.text._setSelectValue("fontSize",t)},setFontFamily:function(t){this.options.fontFamily=t,this._setFont({fontFamily:t}),this.menus.all.text._setSelectValue("fontFamily",t)},setFontBold:function(t){this.options.fontBold=t,this._setFont({fontWeight:t?"bold":""})},setFontItalic:function(t){this.options.fontItalic=t,this._setFont({fontStyle:t?"italic":""})},setFontUnderline:function(t){this.options.fontUnderline=t,this._setFont({fontWeight:t?"underline":""})},_setFont:function(t){this.$textInput.css(t),this.$textCalc.css(t)},_drawTextDown:function(t){this._drawTextIfNotEmpty(),this._drawShapeDown(t,1),this.$textInput.css({left:t.pageX-1,top:t.pageY-1,width:0,height:0}).show().focus()},_drawTextMove:function(t){this._drawShapeMove(t,1),this.$textInput.css({left:t.left-1,top:t.top-1,width:t.width,height:t.height})},_drawTextIfNotEmpty:function(){""!==this.$textInput.val()&&this._drawText()},_drawText:function(){var t,i,n,e,s,o,l="",x=this.$textInput.val().split("\n"),a=[],h=this.$textInput.width()-2,T=0,c=this.$textInput.position(),E=c.left+1,M=c.top+2;for(console.log("initial lines array ",JSON.stringify(x,null,4)),this.options.fontItalic&&(l+="italic "),this.options.fontBold&&(l+="bold "),l+=this.options.fontSize+"px "+this.options.fontFamily,s=-1,t=0,i=x.length;t<i;t++)if(this.$textCalc.html(""),(T=0)!==x[t].length){for(n=0,e=x[t].length;n<e;n++)" "!==(o=x[t].charAt(n))&&"-"!==o&&"+"!==o||(s=n),h<this.$textCalc.append(o).width()&&(0<=s?(a.push(x[t].substring(T,s).trim()),T=s,s=-1):(a.push(x[t].substring(T,n).trim()),T=n),this.$textCalc.html("").append(x[t].substring(T,n)));T!==n&&a.push(x[t].substring(T,n).trim())}else a.push("");for(x=this.$textInput.val(a.join("\n")).val().split("\n"),console.log("final lines array ",JSON.stringify(x,null,4)),t=0,i=x.length;t<i;t++)this.ctx.fillStyle=this.options.fillStyle,this.ctx.textBaseline="top",this.ctx.font=l,this.ctx.fillText(x[t],E,M),M+=this.options.fontSize;this.$textInput.val(""),this._addUndo()}})}(jQuery);